<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¬ ì˜í™” í€´ì¦ˆ ê´€ë¦¬ì</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 15px 30px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section-title {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .question-list {
            margin-top: 30px;
        }

        .question-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .question-number {
            color: #667eea;
            font-weight: 700;
            font-size: 1.1em;
        }

        .question-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }

        .question-hint {
            color: #333;
            font-size: 1.1em;
            margin-bottom: 8px;
        }

        .question-answer {
            color: #28a745;
            font-weight: 600;
            font-size: 1em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .stat-value {
            color: #667eea;
            font-size: 2em;
            font-weight: 700;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #17a2b8;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .result-table th,
        .result-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .result-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .result-table tr:hover {
            background: #f8f9fa;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }

        .help-text {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }

            .question-header {
                flex-direction: column;
            }

            .question-actions {
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¬ ì˜í™” í€´ì¦ˆ ê´€ë¦¬ì</h1>
            <p>ë¬¸ì œ ê´€ë¦¬ ë° ê²°ê³¼ ëª¨ë‹ˆí„°ë§</p>
        </div>

        <div class="content">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('upload')">ğŸ“¤ ë¬¸ì œ ì—…ë¡œë“œ</button>
                <button class="tab" onclick="switchTab('manage')">ğŸ“ ë¬¸ì œ ê´€ë¦¬</button>
                <button class="tab" onclick="switchTab('results')">ğŸ“Š ê²°ê³¼ ì¡°íšŒ</button>
                <button class="tab" onclick="switchTab('setup')">âš™ï¸ ì„¤ì •</button>
            </div>

            <div id="message"></div>

            <!-- ë¬¸ì œ ì—…ë¡œë“œ íƒ­ -->
            <div id="upload-tab" class="tab-content active">
                <h2 class="section-title">ğŸ“ CSV íŒŒì¼ë¡œ ì¼ê´„ ì—…ë¡œë“œ</h2>
                
                <div class="alert alert-info">
                    <strong>ğŸ’¡ CSV íŒŒì¼ í˜•ì‹:</strong><br>
                    â€¢ ì²« ë²ˆì§¸ ì—´: id (ë¬¸ì œ ë²ˆí˜¸)<br>
                    â€¢ ë‘ ë²ˆì§¸ ì—´: movie_hint (ì˜í™” íŒíŠ¸)<br>
                    â€¢ ì„¸ ë²ˆì§¸ ì—´: answer (ì •ë‹µ)<br>
                    â€¢ ì¸ì½”ë”©: UTF-8 (í•œê¸€ ê¹¨ì§ ë°©ì§€)
                </div>

                <div class="btn-group" style="margin-bottom: 30px;">
                    <button class="btn btn-secondary" onclick="downloadTemplate()">ğŸ“¥ CSV í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ</button>
                </div>

                <div class="form-group">
                    <label>CSV íŒŒì¼ ì„ íƒ</label>
                    <input type="file" id="csvFileInput" accept=".csv" style="padding: 10px; border: 2px dashed #667eea; background: #f8f9fa;">
                    <div class="help-text">UTF-8 ì¸ì½”ë”©ëœ CSV íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</div>
                </div>

                <div class="btn-group">
                    <button class="btn" onclick="uploadCSV()">ğŸ“¤ CSV ì—…ë¡œë“œ</button>
                    <button class="btn btn-secondary" onclick="clearCSVInput()">ğŸ—‘ï¸ ì„ íƒ ì´ˆê¸°í™”</button>
                </div>

                <hr style="margin: 40px 0; border: none; border-top: 2px solid #e0e0e0;">

                <h2 class="section-title">ğŸ“ í…ìŠ¤íŠ¸ë¡œ ì¼ê´„ ì—…ë¡œë“œ</h2>
                
                <div class="alert alert-info">
                    <strong>ğŸ’¡ í˜•ì‹ ì•ˆë‚´:</strong> ê° ì¤„ì— "íŒíŠ¸|ì •ë‹µ" í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”.<br>
                    ì˜ˆì‹œ: ì²«ì‚¬ë‘ì˜ ì•„í””ì„ ê·¸ë¦° 2003ë…„ í•œêµ­ ì˜í™”|í´ë˜ì‹
                </div>

                <div class="form-group">
                    <label>ë¬¸ì œ ëª©ë¡ (í•œ ì¤„ì— í•˜ë‚˜ì”©)</label>
                    <textarea id="bulkQuestions" placeholder="ì²«ì‚¬ë‘ì˜ ì•„í””ì„ ê·¸ë¦° 2003ë…„ í•œêµ­ ì˜í™”|í´ë˜ì‹
ì¢€ë¹„ ë°”ì´ëŸ¬ìŠ¤ê°€ í¼ì§„ ê¸°ì°¨ ì•ˆì—ì„œ ë²Œì–´ì§€ëŠ” 2016ë…„ í•œêµ­ ì˜í™”|ë¶€ì‚°í–‰
ì™¸ê³„ì¸ê³¼ ì†Œí†µí•˜ëŠ” ì–¸ì–´í•™ìì˜ ì´ì•¼ê¸°ë¥¼ ê·¸ë¦° 2016ë…„ SF ì˜í™”|ì»¨íƒíŠ¸
ê¿ˆ ì†ì˜ ê¿ˆì„ ë‹¤ë£¬ 2010ë…„ í¬ë¦¬ìŠ¤í† í¼ ë†€ë€ ê°ë… ì˜í™”|ì¸ì…‰ì…˜
íƒ€ì´íƒ€ë‹‰í˜¸ ì¹¨ëª°ì„ ë°°ê²½ìœ¼ë¡œ í•œ 1997ë…„ ë¡œë§¨ìŠ¤ ì˜í™”|íƒ€ì´íƒ€ë‹‰"></textarea>
                    <div class="help-text">íŒíŠ¸ì™€ ì •ë‹µì„ | ê¸°í˜¸ë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥í•˜ì„¸ìš”</div>
                </div>

                <div class="btn-group">
                    <button class="btn" onclick="uploadBulkQuestions()">ğŸ“¤ í…ìŠ¤íŠ¸ ì—…ë¡œë“œ</button>
                    <button class="btn btn-secondary" onclick="clearBulkInput()">ğŸ—‘ï¸ ì…ë ¥ ì´ˆê¸°í™”</button>
                </div>

                <h3 style="margin-top: 40px; margin-bottom: 15px; color: #333;">ê°œë³„ ë¬¸ì œ ì¶”ê°€</h3>
                <div class="form-group">
                    <label>íŒíŠ¸</label>
                    <input type="text" id="singleHint" placeholder="ì˜ˆ: ì²«ì‚¬ë‘ì˜ ì•„í””ì„ ê·¸ë¦° 2003ë…„ í•œêµ­ ì˜í™”">
                </div>
                <div class="form-group">
                    <label>ì •ë‹µ</label>
                    <input type="text" id="singleAnswer" placeholder="ì˜ˆ: í´ë˜ì‹">
                </div>
                <button class="btn" onclick="addSingleQuestion()">â• ë¬¸ì œ ì¶”ê°€</button>
            </div>

            <!-- ë¬¸ì œ ê´€ë¦¬ íƒ­ -->
            <div id="manage-tab" class="tab-content">
                <h2 class="section-title">ë“±ë¡ëœ ë¬¸ì œ ëª©ë¡</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ì´ ë¬¸ì œ ìˆ˜</div>
                        <div class="stat-value" id="totalQuestions">0</div>
                    </div>
                </div>

                <button class="btn btn-secondary" onclick="loadQuestions()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                <button class="btn btn-danger" onclick="deleteAllQuestions()">ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ</button>

                <div class="question-list" id="questionList"></div>
            </div>

            <!-- ê²°ê³¼ ì¡°íšŒ íƒ­ -->
            <div id="results-tab" class="tab-content">
                <h2 class="section-title">í•™ìƒ ê²°ê³¼ ì¡°íšŒ</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ì°¸ì—¬ í•™ìƒ ìˆ˜</div>
                        <div class="stat-value" id="totalStudents">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">í‰ê·  ì ìˆ˜</div>
                        <div class="stat-value" id="avgScore">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ìµœê³  ì ìˆ˜</div>
                        <div class="stat-value" id="maxScore">0</div>
                    </div>
                </div>

                <button class="btn btn-secondary" onclick="loadResults()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                <button class="btn btn-danger" onclick="deleteAllResults()">ğŸ—‘ï¸ ê²°ê³¼ ì „ì²´ ì‚­ì œ</button>

                <table class="result-table" id="resultsTable">
                    <thead>
                        <tr>
                            <th>ìˆœìœ„</th>
                            <th>ì´ë¦„</th>
                            <th>í•™ë²ˆ</th>
                            <th>ì ìˆ˜</th>
                            <th>ì •ë‹µë¥ </th>
                            <th>ì œì¶œ ì‹œê°„</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody"></tbody>
                </table>
            </div>

            <!-- ì„¤ì • íƒ­ -->
            <div id="setup-tab" class="tab-content">
                <h2 class="section-title">Firebase ì„¤ì •</h2>
                
                <div class="alert alert-info">
                    <strong>âš ï¸ ì¤‘ìš”:</strong> Firebase Consoleì—ì„œ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•œ í›„ ì•„ë˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
                </div>

                <div class="form-group">
                    <label>API Key</label>
                    <input type="text" id="apiKey" placeholder="AIzaSy...">
                </div>

                <div class="form-group">
                    <label>Project ID</label>
                    <input type="text" id="projectId" placeholder="my-project-12345">
                </div>

                <div class="form-group">
                    <label>Database URL</label>
                    <input type="text" id="databaseUrl" placeholder="https://my-project-12345-default-rtdb.firebaseio.com">
                </div>

                <button class="btn" onclick="saveConfig()">ğŸ’¾ ì„¤ì • ì €ì¥</button>

                <h3 style="margin-top: 40px; margin-bottom: 15px; color: #333;">ğŸ“– ì‚¬ìš© ê°€ì´ë“œ</h3>
                
                <div class="alert alert-info">
                    <strong>1ë‹¨ê³„: Firebase í”„ë¡œì íŠ¸ ìƒì„±</strong><br>
                    â€¢ <a href="https://console.firebase.google.com" target="_blank">Firebase Console</a>ì—ì„œ ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±<br>
                    â€¢ Realtime Database í™œì„±í™”<br>
                    â€¢ ê·œì¹™ì„ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •:<br>
                </div>

                <div class="code-block">{
  "rules": {
    "questions": {
      ".read": true,
      ".write": true
    },
    "results": {
      ".read": true,
      ".write": true
    }
  }
}</div>

                <div class="alert alert-info">
                    <strong>2ë‹¨ê³„: ì„¤ì • ì •ë³´ ì…ë ¥</strong><br>
                    â€¢ í”„ë¡œì íŠ¸ ì„¤ì •ì—ì„œ ì›¹ ì•± ì¶”ê°€<br>
                    â€¢ Firebase ì„¤ì • ì •ë³´ ë³µì‚¬<br>
                    â€¢ ìœ„ í¼ì— ì •ë³´ ì…ë ¥ í›„ ì €ì¥<br>
                    â€¢ í•™ìƒìš© ì‚¬ì´íŠ¸ì—ë„ ë™ì¼í•œ ì„¤ì • ì…ë ¥
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, get, set, push, remove, query, orderByChild } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase ì„¤ì • (ì—¬ê¸°ì— ë³¸ì¸ì˜ Firebase ì„¤ì •ì„ ì…ë ¥í•˜ì„¸ìš”)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // ì „ì—­ í•¨ìˆ˜ ë…¸ì¶œ
        window.switchTab = switchTab;
        window.downloadTemplate = downloadTemplate;
        window.uploadCSV = uploadCSV;
        window.clearCSVInput = clearCSVInput;
        window.uploadBulkQuestions = uploadBulkQuestions;
        window.clearBulkInput = clearBulkInput;
        window.addSingleQuestion = addSingleQuestion;
        window.loadQuestions = loadQuestions;
        window.deleteQuestion = deleteQuestion;
        window.deleteAllQuestions = deleteAllQuestions;
        window.loadResults = loadResults;
        window.deleteAllResults = deleteAllResults;
        window.saveConfig = saveConfig;

        function switchTab(tabName) {
            // íƒ­ ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // íƒ­ ì½˜í…ì¸  í‘œì‹œ
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');

            // íƒ­ ì „í™˜ ì‹œ ë°ì´í„° ë¡œë“œ
            if (tabName === 'manage') {
                loadQuestions();
            } else if (tabName === 'results') {
                loadResults();
            }
        }

        function showMessage(message, type = 'success') {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }

        // CSV í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
        function downloadTemplate() {
            const csvContent = '\ufeffid,movie_hint,answer\n' +
                '1,ì²«ì‚¬ë‘ì˜ ì•„í””ì„ ê·¸ë¦° 2003ë…„ í•œêµ­ ì˜í™”,í´ë˜ì‹\n' +
                '2,ì¢€ë¹„ ë°”ì´ëŸ¬ìŠ¤ê°€ í¼ì§„ ê¸°ì°¨ ì•ˆì—ì„œ ë²Œì–´ì§€ëŠ” 2016ë…„ í•œêµ­ ì˜í™”,ë¶€ì‚°í–‰\n' +
                '3,ì™¸ê³„ì¸ê³¼ ì†Œí†µí•˜ëŠ” ì–¸ì–´í•™ìì˜ ì´ì•¼ê¸°ë¥¼ ê·¸ë¦° 2016ë…„ SF ì˜í™”,ì»¨íƒíŠ¸\n' +
                '4,ê¿ˆ ì†ì˜ ê¿ˆì„ ë‹¤ë£¬ 2010ë…„ í¬ë¦¬ìŠ¤í† í¼ ë†€ë€ ê°ë… ì˜í™”,ì¸ì…‰ì…˜\n' +
                '5,íƒ€ì´íƒ€ë‹‰í˜¸ ì¹¨ëª°ì„ ë°°ê²½ìœ¼ë¡œ í•œ 1997ë…„ ë¡œë§¨ìŠ¤ ì˜í™”,íƒ€ì´íƒ€ë‹‰';

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'movie_quiz_template.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showMessage('âœ… CSV í…œí”Œë¦¿ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        // CSV íŒŒì¼ ì—…ë¡œë“œ
        async function uploadCSV() {
            const fileInput = document.getElementById('csvFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showMessage('CSV íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            if (!file.name.endsWith('.csv')) {
                showMessage('CSV íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            try {
                const text = await readFileAsText(file);
                const lines = text.split('\n').filter(line => line.trim());
                
                if (lines.length < 2) {
                    showMessage('CSV íŒŒì¼ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                // í—¤ë” í™•ì¸
                const header = lines[0].toLowerCase().replace(/\r/g, '');
                if (!header.includes('id') || !header.includes('movie_hint') || !header.includes('answer')) {
                    showMessage('CSV íŒŒì¼ì˜ í—¤ë”ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. í…œí”Œë¦¿ì„ ì°¸ê³ í•˜ì„¸ìš”.', 'error');
                    return;
                }

                let successCount = 0;
                let errorCount = 0;

                // ë°ì´í„° í–‰ ì²˜ë¦¬ (ì²« ë²ˆì§¸ ì¤„ì€ í—¤ë”ì´ë¯€ë¡œ ì œì™¸)
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].replace(/\r/g, '');
                    if (!line.trim()) continue;

                    // CSV íŒŒì‹± (ì‰¼í‘œë¡œ êµ¬ë¶„, ë”°ì˜´í‘œ ì²˜ë¦¬)
                    const values = parseCSVLine(line);
                    
                    if (values.length < 3) {
                        errorCount++;
                        console.log('ì˜ëª»ëœ í˜•ì‹:', line);
                        continue;
                    }

                    const id = values[0].trim();
                    const hint = values[1].trim();
                    const answer = values[2].trim();

                    if (hint && answer) {
                        try {
                            const questionsRef = ref(database, 'questions');
                            await push(questionsRef, {
                                id: id,
                                hint: hint,
                                answer: answer,
                                createdAt: new Date().toISOString()
                            });
                            successCount++;
                        } catch (error) {
                            errorCount++;
                            console.error('ë¬¸ì œ ì¶”ê°€ ì˜¤ë¥˜:', error);
                        }
                    } else {
                        errorCount++;
                    }
                }

                showMessage(`âœ… ${successCount}ê°œ ë¬¸ì œ ì—…ë¡œë“œ ì™„ë£Œ! ${errorCount > 0 ? `(ì‹¤íŒ¨: ${errorCount}ê°œ)` : ''}`, 'success');
                fileInput.value = '';
                loadQuestions();
            } catch (error) {
                showMessage('CSV íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // CSV ë¼ì¸ íŒŒì‹± í•¨ìˆ˜ (ì‰¼í‘œì™€ ë”°ì˜´í‘œ ì²˜ë¦¬)
        function parseCSVLine(line) {
            const values = [];
            let current = '';
            let inQuotes = false;

            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const nextChar = line[i + 1];

                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        // ì´ìŠ¤ì¼€ì´í”„ëœ ë”°ì˜´í‘œ
                        current += '"';
                        i++;
                    } else {
                        // ë”°ì˜´í‘œ í† ê¸€
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    // í•„ë“œ êµ¬ë¶„ì
                    values.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }

            values.push(current);
            return values;
        }

        // íŒŒì¼ì„ UTF-8ë¡œ ì½ê¸°
        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(e);
                reader.readAsText(file, 'UTF-8');
            });
        }

        // CSV ì…ë ¥ ì´ˆê¸°í™”
        function clearCSVInput() {
            document.getElementById('csvFileInput').value = '';
        }

        async function uploadBulkQuestions() {
            const bulkText = document.getElementById('bulkQuestions').value.trim();
            
            if (!bulkText) {
                showMessage('ë¬¸ì œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const lines = bulkText.split('\n').filter(line => line.trim());
            let successCount = 0;
            let errorCount = 0;

            for (const line of lines) {
                const parts = line.split('|');
                if (parts.length !== 2) {
                    errorCount++;
                    continue;
                }

                const hint = parts[0].trim();
                const answer = parts[1].trim();

                if (hint && answer) {
                    try {
                        const questionsRef = ref(database, 'questions');
                        await push(questionsRef, {
                            hint: hint,
                            answer: answer,
                            createdAt: new Date().toISOString()
                        });
                        successCount++;
                    } catch (error) {
                        errorCount++;
                        console.error('ë¬¸ì œ ì¶”ê°€ ì˜¤ë¥˜:', error);
                    }
                }
            }

            showMessage(`âœ… ${successCount}ê°œ ë¬¸ì œ ì—…ë¡œë“œ ì™„ë£Œ! ${errorCount > 0 ? `(ì‹¤íŒ¨: ${errorCount}ê°œ)` : ''}`, 'success');
            document.getElementById('bulkQuestions').value = '';
            loadQuestions();
        }

        function clearBulkInput() {
            document.getElementById('bulkQuestions').value = '';
        }

        async function addSingleQuestion() {
            const hint = document.getElementById('singleHint').value.trim();
            const answer = document.getElementById('singleAnswer').value.trim();

            if (!hint || !answer) {
                showMessage('íŒíŠ¸ì™€ ì •ë‹µì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            try {
                const questionsRef = ref(database, 'questions');
                await push(questionsRef, {
                    hint: hint,
                    answer: answer,
                    createdAt: new Date().toISOString()
                });

                showMessage('âœ… ë¬¸ì œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                document.getElementById('singleHint').value = '';
                document.getElementById('singleAnswer').value = '';
                loadQuestions();
            } catch (error) {
                showMessage('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        }

        async function loadQuestions() {
            try {
                const questionsRef = ref(database, 'questions');
                const snapshot = await get(questionsRef);

                if (snapshot.exists()) {
                    const questions = [];
                    snapshot.forEach((child) => {
                        questions.push({
                            id: child.key,
                            ...child.val()
                        });
                    });

                    document.getElementById('totalQuestions').textContent = questions.length;

                    const listHTML = questions.map((q, index) => `
                        <div class="question-item">
                            <div class="question-header">
                                <div class="question-number">ë¬¸ì œ ${index + 1}</div>
                                <div class="question-actions">
                                    <button class="btn btn-small btn-danger" onclick="deleteQuestion('${q.id}')">ì‚­ì œ</button>
                                </div>
                            </div>
                            <div class="question-hint">ğŸ“ ${q.hint}</div>
                            <div class="question-answer">âœ… ì •ë‹µ: ${q.answer}</div>
                        </div>
                    `).join('');

                    document.getElementById('questionList').innerHTML = listHTML || '<p>ë“±ë¡ëœ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                } else {
                    document.getElementById('totalQuestions').textContent = '0';
                    document.getElementById('questionList').innerHTML = '<p>ë“±ë¡ëœ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } catch (error) {
                showMessage('ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        }

        async function deleteQuestion(questionId) {
            if (!confirm('ì´ ë¬¸ì œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                const questionRef = ref(database, `questions/${questionId}`);
                await remove(questionRef);
                showMessage('âœ… ë¬¸ì œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                loadQuestions();
            } catch (error) {
                showMessage('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        }

        async function deleteAllQuestions() {
            if (!confirm('ì •ë§ ëª¨ë“  ë¬¸ì œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) {
                return;
            }

            try {
                const questionsRef = ref(database, 'questions');
                await remove(questionsRef);
                showMessage('âœ… ëª¨ë“  ë¬¸ì œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                loadQuestions();
            } catch (error) {
                showMessage('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        }

        async function loadResults() {
            try {
                const resultsRef = ref(database, 'results');
                const resultsQuery = query(resultsRef, orderByChild('score'));
                const snapshot = await get(resultsQuery);

                if (snapshot.exists()) {
                    const results = [];
                    snapshot.forEach((child) => {
                        results.push(child.val());
                    });

                    // ì ìˆ˜ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
                    results.sort((a, b) => b.score - a.score);

                    // í†µê³„ ê³„ì‚°
                    const totalStudents = results.length;
                    const avgScore = Math.round(results.reduce((sum, r) => sum + r.score, 0) / totalStudents);
                    const maxScore = Math.max(...results.map(r => r.score));

                    document.getElementById('totalStudents').textContent = totalStudents;
                    document.getElementById('avgScore').textContent = avgScore;
                    document.getElementById('maxScore').textContent = maxScore;

                    // í…Œì´ë¸” ìƒì„±
                    const tableHTML = results.map((result, index) => {
                        const date = new Date(result.timestamp);
                        const accuracy = result.correctAnswers ? 
                            Math.round((result.correctAnswers / 5) * 100) : 0; // ì´ ë¬¸ì œ ìˆ˜ 5ê°œ ê°€ì •
                        
                        return `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${result.name}</td>
                                <td>${result.studentId}</td>
                                <td><strong>${result.score}ì </strong></td>
                                <td>${accuracy}%</td>
                                <td>${date.toLocaleString('ko-KR')}</td>
                            </tr>
                        `;
                    }).join('');

                    document.getElementById('resultsBody').innerHTML = tableHTML;
                } else {
                    document.getElementById('totalStudents').textContent = '0';
                    document.getElementById('avgScore').textContent = '0';
                    document.getElementById('maxScore').textContent = '0';
                    document.getElementById('resultsBody').innerHTML = 
                        '<tr><td colspan="6" style="text-align: center;">ì œì¶œëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                }
            } catch (error) {
                showMessage('ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        }

        async function deleteAllResults() {
            if (!confirm('ì •ë§ ëª¨ë“  í•™ìƒ ê²°ê³¼ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) {
                return;
            }

            try {
                const resultsRef = ref(database, 'results');
                await remove(resultsRef);
                showMessage('âœ… ëª¨ë“  ê²°ê³¼ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                loadResults();
            } catch (error) {
                showMessage('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        }

        function saveConfig() {
            const config = {
                apiKey: document.getElementById('apiKey').value.trim(),
                projectId: document.getElementById('projectId').value.trim(),
                databaseUrl: document.getElementById('databaseUrl').value.trim()
            };

            if (!config.apiKey || !config.projectId || !config.databaseUrl) {
                showMessage('ëª¨ë“  ì„¤ì • ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            localStorage.setItem('firebaseConfig', JSON.stringify(config));
            showMessage('âœ… ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ì ìš©í•˜ì„¸ìš”.', 'success');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¬¸ì œ ëª©ë¡ ë¡œë“œ
        loadQuestions();
    </script>
</body>
</html>
